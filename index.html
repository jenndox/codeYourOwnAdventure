<!DOCTYPE html>
 <html>
   <meta charset="UTF-8">
    <head>
       <title>Code your own Adventure</title>
       <link rel="stylesheet" type="text/css" href="book.css">
       <script type="text/javascript" src="jquery-1.7.min.js"></script>
    </head>
    <body>
      <div id="bookCreator">
<div class="newSegment">// Tell me your story!</div>

<div>private Book createStoryBook()</div>
<div>{</div>
    <div class="indentOnce">// Give your book a title.</div>
    <div class="indentOnce">string bookTitle = <input class="variableName" id="bookTitle" class="titleText" title="title" placeholder="My Book's Title"/>;</div>
    
    <div class="indentOnce newSegment">// What is your name?</div>
    <div class="indentOnce">string authorName = <input class="variableName" id="authorName" class="authorText" title="your name" placeholder="Your Name"/>;</div>
    
    <div id="friendsSection">
    <div class="indentOnce newSegment">// Then imagine a friend.</div>
    </div>
    <div class="indentOnce newSegment""><button onclick="addFriend()" class="finalButtons" id="friendAdder">Add a friend</button></div>

    <div class="indentOnce newSegment">// Where do the friends live?</div>
    <div class="indentOnce">Home friendsHome = new Home( <select name="homeForFriend" class="dropDownSelector" onchange="updateHome(this.value);">
    <option>cave</option><option>tree</option>
    <option>pond</option><option>cloud</option></select> );</div>
    
    <div class="indentOnce newSegment">return new Book(bookTitle, authorName);</div>
    
<div newSegment>}</div>
<br />
<button type="submit" name="createBook" id="createBook" class="finalButtons" onclick="saveValues();">create my book</button> <button type="reset" name="clearBook" id="clearBook" class="finalButtons" onclick="resetValues();">start all over</button>
<br />
      </div>
      
      <script type="text/javascript">
         var friendCounter = 0;
         var maxFriends = 5;
         var friends = [];
         
         var bookTitle = "My Book's Title";
         var authorName = "The Great Adventure Writer";
         var home = "cave";
         
         var animalOptions = new Array("lion", "penguin", "rhino",
                                       "jellyfish", "turtle", "snake",
                                       "elephant", "whale", "bear", 
                                       "bird", "seahorse", "zebra");
         
         var weatherOptions = new Array("sunny", "cloudy", "rainy", "snowy", "breezy", "chilly");
         var weatherIndex = Math.floor(Math.random() * weatherOptions.length); 
         var weather = weatherOptions[weatherIndex];
         
      
         jQuery(document).ready(function () {
            addFriend();
            configureEventHandlers();
        });
      
         function addFriend()
         {
            var allAnimalOptions = "";
            for (var idx = 0; idx < animalOptions.length; idx++)
            {
               allAnimalOptions = allAnimalOptions + '<option style="background-image:url(' + animalOptions[idx] + '.png); background-repeat:no-repeat; background-position:right center; height:54px; min-width:180px;">' + animalOptions[idx] + "</option>";
            }
            
            var structureForNewFriend = '<div class="indentOnce">Friend <input class="variableName friendName" id="friendName' + friendCounter + '" title="name ' + friendCounter + '" placeholder="Friend number ' + (friendCounter + 1) + '" /> = new Friend( <select name="speciesFriend" id="speciesFriend" class="dropDownSelector" onchange="updateFriendAnimal(' + friendCounter + ', this.value);">' + allAnimalOptions + '</select> );</div></div>';
          
            jQuery("#friendsSection").append(structureForNewFriend);
            
            var nameElement = document.getElementById("friendName" + friendCounter );
            
            if ( nameElement.addEventListener ) {
              nameElement.addEventListener("focus", nameFocus, false);
              nameElement.addEventListener("blur", nameBlur, false);
            } else if ( nameElement.attachEvent ) {
              nameElement.attachEvent("onfocus", nameFocus);
              nameElement.attachEvent("onblur", nameBlur);
            }
            
            // Add the friend to our list.
            var friendData = new Array(2);
            friendData[0] = "Friend number " + (friendCounter + 1) ;
            friendData[1] = animalOptions[0];
            friends.push(friendData);
            friendCounter++;
            
            if (friendCounter >= maxFriends)
            {

               jQuery("#friendAdder").hide();
            }
         }
         
         function updateFriendAnimal(friendIndex, value)
         {
            friends[friendIndex][1] = value;
         }
         
         function updateHome(value)
         {
            home = value;
         }
         
         function saveValues()
         {
            writeCookies();
            window.location.href = "book.html";
         }
         
         function writeCookies()
         {
            document.cookie = "friendsCount=" + friends.length + ";";
            
            for (var index=0; index < friends.length; index++)
            {
               document.cookie = "friendsName" + index + "=" + friends[index][0] + ";";
               document.cookie = "friendsSpecies" + index + "=" + friends[index][1] + ";";
            }
            
            document.cookie = "bookTitle=" + bookTitle + ";";
            document.cookie = "authorName=" + authorName + ";";
            document.cookie = "home=" + home + ";";
            document.cookie = "weather=" + weather + ";";
         }
         
         function nullifyCookies()
         {
            document.cookie = "friendsCount=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            
            for (var index=0; index < maxFriends; index++)
            {
               document.cookie = "friendsName" + index + "=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
               document.cookie = "friendsSpecies" + index + "=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            }
            
            document.cookie = "bookTitle=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            document.cookie = "authorName=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            document.cookie = "home=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            document.cookie = "weather=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
         }

         
         function resetValues()
         {
            nullifyCookies();
            
            // Reset to default values.
            friendCounter = 0;
            friends = [];
            
            bookTitle = "My Book's Title";
            authorName = "You Name";
            home = "cave";
            
            weatherIndex = Math.floor(Math.random() * weatherOptions.length); 
            weather = weatherOptions[weatherIndex];
         
            location.reload();
         }
         
         function configureEventHandlers()
         {
            // bookTitle
             var titleElement = document.getElementById("bookTitle");
             if ( titleElement.addEventListener ) {
               titleElement.addEventListener("focus", bookTitleFocus, false);
               titleElement.addEventListener("blur", bookTitleBlur, false);
             } else if ( titleElement.attachEvent ) {
               titleElement.attachEvent("onfocus", bookTitleFocus);
               titleElement.attachEvent("onblur", bookTitleBlur);
             }
             
             // authorName
             var authorElement = document.getElementById("authorName");
             if ( authorElement.addEventListener ) {
               authorElement.addEventListener("focus", authorNameFocus, false);
               authorElement.addEventListener("blur", authorNameBlur, false);
             } else if ( authorElement.attachEvent ) {
               authorElement.attachEvent("onfocus", authorNameFocus);
               authorElement.attachEvent("onblur", authorNameBlur);
             }
         }
         
         function bookTitleFocus( e ) {
            var element = e.target || window.event.srcElement;
            if (element.value == "My Book's Title")
            {
               element.value = "";
            }
         }
         
         function bookTitleBlur( e ) {
            var element = e.target || window.event.srcElement;
            if (element.value == "")
            {
               element.value = "My Book's Title";
            }
            else
            {
               bookTitle = element.value;
            }
         }
         
         function authorNameFocus( e ) {
            var element = e.target || window.event.srcElement;
            if (element.value == "Your Name")
            {
               element.value = "";
            }
         }
         
         function authorNameBlur( e ) {
            var element = e.target || window.event.srcElement;
            if (element.value == "")
            {
               element.value = "Your Name";
            }
            else
            {
               authorName = element.value;
            }
         }
         
         function nameFocus( e ) {
            var elementName = e.currentTarget.id;
            var friendIndex = elementName.substring(10, elementName.length);
            var element = e.target || window.event.srcElement;
            if (element.value == "Friend number " + (friendCounter + 1)) element.value = "";
         }
         
         function nameBlur( e ) {
            var elementName = e.currentTarget.id;
            var friendIndex = elementName.substring(10, elementName.length);
            
            var element = e.target || window.event.srcElement;
            if (element.value == "")
            {
               element.value = "Friend number " + (friendCounter + 1);
            }
            else
            {
               friends[friendIndex][0] = e.currentTarget.value;
            }
         }
      </script>
    </body>
 </html>